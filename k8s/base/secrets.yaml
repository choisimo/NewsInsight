# NewsInsight External Secrets (uses GCP Secret Manager)
# This file defines ExternalSecret resources that sync secrets from GCP Secret Manager
# Requires: external-secrets operator installed in the cluster
---
apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: gcp-secret-store
  namespace: newsinsight
spec:
  provider:
    gcpsm:
      projectID: ${newsinsight-478812}
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: newsinsight-secrets
  namespace: newsinsight
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: gcp-secret-store
    kind: SecretStore
  target:
    name: newsinsight-secrets
    creationPolicy: Owner
  data:
    # Database
    - secretKey: DB_PASSWORD
      remoteRef:
        key: newsinsight-db-password
    - secretKey: MONGODB_URI
      remoteRef:
        key: newsinsight-mongodb-uri
    
    # Redis
    - secretKey: REDIS_PASSWORD
      remoteRef:
        key: newsinsight-redis-password
    
    # JWT
    - secretKey: JWT_SECRET_KEY
      remoteRef:
        key: newsinsight-jwt-secret
    
    # AI API Keys
    - secretKey: OPENAI_API_KEY
      remoteRef:
        key: openai-api-key
    - secretKey: ANTHROPIC_API_KEY
      remoteRef:
        key: anthropic-api-key
    - secretKey: PERPLEXITY_API_KEY
      remoteRef:
        key: perplexity-api-key
    
    # Search API Keys
    - secretKey: BRAVE_API_KEY
      remoteRef:
        key: brave-search-api-key
    - secretKey: TAVILY_API_KEY
      remoteRef:
        key: tavily-api-key
    
    # Consul Token
    - secretKey: CONSUL_HTTP_TOKEN
      remoteRef:
        key: consul-token
---
# Fallback: Manual Secret (use this if not using external-secrets operator)
# Uncomment and fill in base64 encoded values
# apiVersion: v1
# kind: Secret
# metadata:
#   name: newsinsight-secrets
#   namespace: newsinsight
# type: Opaque
# data:
#   DB_PASSWORD: <base64-encoded>
#   MONGODB_URI: <base64-encoded>
#   REDIS_PASSWORD: <base64-encoded>
#   JWT_SECRET_KEY: <base64-encoded>
#   OPENAI_API_KEY: <base64-encoded>
#   ANTHROPIC_API_KEY: <base64-encoded>
#   PERPLEXITY_API_KEY: <base64-encoded>
