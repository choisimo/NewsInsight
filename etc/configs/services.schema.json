{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://newsinsight.nodove.com/schemas/services.json",
  "title": "NewsInsight Services Configuration",
  "description": "Schema for validating NewsInsight service configuration profiles",
  "type": "object",
  "required": ["version", "services"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "Reference to the JSON schema file"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Semantic version of the configuration"
    },
    "description": {
      "type": "string",
      "description": "Human-readable description of this configuration"
    },
    "services": {
      "type": "object",
      "description": "Service definitions",
      "additionalProperties": {
        "$ref": "#/$defs/serviceDefinition"
      }
    },
    "ml-addons": {
      "type": "object",
      "description": "ML addon service definitions",
      "additionalProperties": {
        "$ref": "#/$defs/mlAddonDefinition"
      }
    },
    "infrastructure": {
      "type": "object",
      "description": "Infrastructure service definitions",
      "additionalProperties": {
        "$ref": "#/$defs/infrastructureDefinition"
      }
    }
  },
  "$defs": {
    "port": {
      "type": "integer",
      "minimum": 1,
      "maximum": 65535,
      "description": "Network port number"
    },
    "resourceValue": {
      "type": "string",
      "pattern": "^\\d+(Mi|Gi|m)?$",
      "description": "Kubernetes resource value (e.g., 256Mi, 1Gi, 500m)"
    },
    "environmentName": {
      "type": "string",
      "enum": ["development", "staging", "production"],
      "description": "Environment name"
    },
    "resources": {
      "type": "object",
      "properties": {
        "memory": {
          "$ref": "#/$defs/resourceValue",
          "description": "Memory allocation (e.g., 512Mi, 2Gi)"
        },
        "cpu": {
          "$ref": "#/$defs/resourceValue",
          "description": "CPU allocation (e.g., 250m, 1000m)"
        }
      },
      "additionalProperties": false
    },
    "environmentProfile": {
      "type": "object",
      "required": ["replicas", "resources"],
      "properties": {
        "replicas": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100,
          "description": "Number of replicas for this environment"
        },
        "resources": {
          "$ref": "#/$defs/resources"
        },
        "env": {
          "type": "object",
          "description": "Environment-specific variables",
          "additionalProperties": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "serviceDefinition": {
      "type": "object",
      "required": ["name", "port", "healthcheck", "profiles"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Human-readable service name"
        },
        "description": {
          "type": "string",
          "description": "Service description"
        },
        "port": {
          "$ref": "#/$defs/port"
        },
        "healthcheck": {
          "type": "string",
          "description": "Health check endpoint path"
        },
        "dependencies": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of service dependencies"
        },
        "profiles": {
          "type": "object",
          "required": ["development", "staging", "production"],
          "properties": {
            "development": {
              "$ref": "#/$defs/environmentProfile"
            },
            "staging": {
              "$ref": "#/$defs/environmentProfile"
            },
            "production": {
              "$ref": "#/$defs/environmentProfile"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "mlAddonDefinition": {
      "type": "object",
      "required": ["name", "port", "healthcheck", "enabled"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Human-readable addon name"
        },
        "port": {
          "$ref": "#/$defs/port"
        },
        "healthcheck": {
          "type": "string",
          "description": "Health check endpoint path"
        },
        "enabled": {
          "type": "object",
          "required": ["development", "staging", "production"],
          "properties": {
            "development": {
              "type": "boolean"
            },
            "staging": {
              "type": "boolean"
            },
            "production": {
              "type": "boolean"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "infrastructureDefinition": {
      "type": "object",
      "required": ["image", "port"],
      "properties": {
        "image": {
          "type": "string",
          "description": "Docker image reference"
        },
        "port": {
          "$ref": "#/$defs/port"
        },
        "healthcheck": {
          "type": "string",
          "description": "Health check command"
        }
      },
      "additionalProperties": false
    }
  }
}
